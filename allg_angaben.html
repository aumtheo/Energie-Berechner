<!DOCTYPE html>
<html>
<head>
  <title>Allgemeine Angaben</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="static/css/style.css">
</head>

<body>
  <!-- Top Navigation Bar -->
  <div class="top-nav">
    <a href="/" class="home-button">
      <div class="home-icon">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 10.25V20C3 20.5523 3.44771 21 4 21H8.42857C8.98086 21 9.42857 20.5523 9.42857 20V13.2857C9.42857 13.1288 9.55301 13 9.71429 13H14.2857C14.447 13 14.5714 13.1288 14.5714 13.2857V20C14.5714 20.5523 15.0191 21 15.5714 21H20C20.5523 21 21 20.5523 21 20V10.25C21 9.93524 20.8518 9.63885 20.6 9.45L12.35 3.45C12.1343 3.28313 11.8657 3.28313 11.65 3.45L3.4 9.45C3.14819 9.63885 3 9.93524 3 10.25Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <span>HOME</span>
    </a>
    
    <div class="nav-sections">
      <a href="/allg-angaben" class="nav-section active">
        <div class="section-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 5H21V19H3V5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7 9H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7 13H17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span>Gebäude allg.</span>
      </a>
      
      <a href="/bauteil" class="nav-section">
        <div class="section-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 8V16M8 12H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <span>techn. Anlagen</span>
      </a>
      
      <a href="/waermequellen" class="nav-section">
        <div class="section-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 16C8 18.2091 9.79086 20 12 20C14.2091 20 16 18.2091 16 16C16 13.7909 14.2091 12 12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 12V4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span>Wärmequellen</span>
      </a>
      
      <a href="/gwp" class="nav-section">
        <div class="section-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 3V21H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7 15L11 11L15 15L21 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span>GWP</span>
      </a>
      
      <a href="/ergebnis" class="nav-section">
        <div class="section-icon">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 12H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 16H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 12H9.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 16H9.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span>Ergebnis</span>
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-container">
    <!-- Left Sidebar - Energy Values -->
    <div class="left-sidebar">
      <div class="energy-section">
        <h2 class="energy-title">Nutzenergiebedarf</h2>
        <div class="energy-card">
          <div class="energy-values">
            <div class="energy-value">
              <span id="ausgabe_ne_abs">- kwh/a</span>
            </div>
            <div class="energy-value">
              <span id="ausgabe_ne_spec">- kwh/m²a</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="energy-section">
        <h2 class="energy-title">Energiebedarf</h2>
        <div class="energy-card">
          <div class="energy-values">
            <div class="energy-value">
              <span>- kwh/a</span>
            </div>
            <div class="energy-value">
              <span>- kwh/m²a</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="energy-section">
        <h2 class="energy-title">Primärnergiebedarf</h2>
        <div class="energy-card">
          <div class="energy-values">
            <div class="energy-value">
              <span>- kwh/a</span>
            </div>
            <div class="energy-value">
              <span>- kwh/m²a</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="energy-section">
        <h2 class="energy-title">Strom (Überschuss)</h2>
        <div class="energy-card">
          <div class="energy-values">
            <div class="energy-value">
              <span>- kwh/a</span>
            </div>
            <div class="energy-value">
              <span>- kwh/m²a</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="energy-section">
        <h2 class="energy-title">Sonnenschutz</h2>
        <div class="energy-card">
          <span>Nein</span>
        </div>
      </div>
      
      <div class="energy-section">
        <h2 class="energy-title">GWP Var. 1</h2>
        <div class="energy-card">
          <span>- a</span>
        </div>
      </div>
      
      <div class="energy-section">
        <h2 class="energy-title">GWP Var. 2</h2>
        <div class="energy-card">
          <span>- a</span>
        </div>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="content-area">
      <div class="content-card">
        <h1 class="content-title">Allgemeine Angaben</h1>
        <div class="form-container">
          <div class="form-row">
            <div class="form-label">Name</div>
            <div class="form-input">
              <input type="text" id="name" name="name" />
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-label">Beschreibung</div>
            <div class="form-input">
              <input type="text" id="beschreibung" name="beschreibung" />
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-label">Ort</div>
            <div class="form-input">
              <select id="ort" name="ort" class="form-control">
                <option value="">— bitte wählen —</option>
                <option value="München">München</option>
                <option value="Berlin">Berlin</option>
                <option value="Hamburg">Hamburg</option>
                <option value="Köln">Köln</option>
                <option value="Frankfurt">Frankfurt</option>
                <option value="Stuttgart">Stuttgart</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-label">Gebäudeart</div>
            <div class="form-input">
              <select id="geb_klasse" name="geb_klasse" class="form-control">
                <option value="buero">Bürogebäude</option>
                <option value="schule">Schule (ohne Dusche)</option>
                <option value="heim">Heim</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-label">Geschosshöhe</div>
            <div class="form-input">
              <input type="text" id="geschosshoehe" name="geschosshoehe" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Sidebar - Help -->
    <div class="right-sidebar">
      <h1 class="help-title">Eingabe Hilfe</h1>
      <p class="help-text">
        Geben Sie nacheinander alle Bauteile der <strong>thermischen Gebäudehülle</strong> ein. 
        Hierzu geben Sie die einzelnen Bauteilschichten von <strong>innen nach außen</strong> an. 
        Beachten Sie die Wärmeübergangswiederstände bei *1.
      </p>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <!-- Logo -->
      <div class="footer-logo">
        <img src="static/images/Logo.png" alt="G|iB SMART Logo" class="logo" />
      </div>
      
      <!-- Back Button -->
      <div class="footer-button">
        <a href="/" class="button">Back</a>
      </div>
      
      <!-- Next Button -->
      <div class="footer-button">
        <a href="/baukrper" class="button">Next</a>
      </div>
      
      <!-- Spacer -->
      <div class="footer-spacer"></div>
    </div>
  </footer>

  <script>
    // Lookup-Tabelle: je Gebäudeart voreingestellte Werte
    const gebaeudeDefaults = {
      buero: {
        tw_pro_m2: 15,    // z.B. Trinkwarmwasserbedarf kWh/m²
        lwt_pro_m2: 8,    // Lüftungsenergiebedarf kWh/m²
        bel_pro_m2: 10,   // Beleuchtung kWh/m²
        nutzer_pro_m2: 5  // Prozessenergie kWh/m²
      },
      schule: {
        tw_pro_m2: 5,
        lwt_pro_m2: 6,
        bel_pro_m2: 12,
        nutzer_pro_m2: 2
      },
      heim: {
        tw_pro_m2: 25,
        lwt_pro_m2: 5,
        bel_pro_m2: 8,
        nutzer_pro_m2: 3
      }
    };

    // alle inputs + das select
    const inputs = Array.from(document.querySelectorAll("input[name]"));
    const gebSelect = document.getElementById("geb_klasse");
    
    // Null-Check für Elemente
    if (gebSelect) {
      // reagiere auch auf Änderungen des Dropdowns
      gebSelect.addEventListener("change", update);
    }
    
    inputs.forEach(i => {
      if (i) i.addEventListener("input", update);
    });

    update(); // Erstaufruf

    function update() {
      const params = new URLSearchParams();

      // 1) Übernehme alle "normalen" Inputs
      inputs.forEach(i => {
        if (i && i.name) params.set(i.name, i.value);
      });

      // 2) Fülle die Default-Werte für Trinkwasser/Lüftung/Beleuchtung/Prozess
      if (gebSelect) {
        const defaults = gebaeudeDefaults[gebSelect.value];
        if (defaults) {
          for (const [key, val] of Object.entries(defaults)) {
            params.set(key, val);
          }
        }
      }

      // 3) API-Call
      fetch(`/api/berechnung/?${params}`)
        .then(r => r.json())
        .then(data => {
          // Beispielausgaben - mit Null-Checks
          const neAbs = document.getElementById("ausgabe_ne_abs");
          const neSpec = document.getElementById("ausgabe_ne_spec");
          
          if (neAbs && data.nutzenergie?.ne_gesamt) {
            neAbs.textContent = data.nutzenergie.ne_gesamt + " kwh/a";
          }
          
          if (neSpec && data.nutzenergie?.ne_spezifisch) {
            neSpec.textContent = data.nutzenergie.ne_spezifisch + " kwh/m²a";
          }
        })
        .catch(console.error);
    }
  </script>
</body>
</html>